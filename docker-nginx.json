{
  "variables": {
    "source_docker_image": "{{ user `img` }}"
  },
  "builders": [{
    "name": "{{ user `img` }}-nginx-beta",
    "type": "docker",
    "image": "{{ user `source_docker_image` }}",
    "commit": "true",
    "changes": [
      "EXPOSE 80 443",
      "ONBUILD RUN date",
      "CMD [\"nginx\", \"-g\", \"daemon off;\"]",
      "ENTRYPOINT /var/www/start.sh"
    ]
  }],
 "provisioners": [
   {
     "type": "file",
     "source": "install_ansible.sh",
     "destination": "/tmp/install.sh"
   },
   {
     "inline": [
       "chmod +x /tmp/install.sh",
       "/tmp/install.sh"
     ],
     "type": "shell"
   },
   {
     "type": "ansible-local",
     "playbook_file": "nginx.yml",
     "playbook_dir": "."
   }
 ],
 "post-processors": [{
   "type": "docker-tag",
   "repository": "homework/{{ user `img` }}-nginx-beta",
   "tag": "latest"
 }]
}
